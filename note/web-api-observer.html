<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      现代浏览器ObserverAPI | ZRQ30之喵帕斯博客
    </title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/nyanpass-blog/assets/style.ed7e709c.css">
    <link rel="modulepreload" href="/nyanpass-blog/assets/Home.9711dcd4.js">
    <link rel="modulepreload" href="/nyanpass-blog/assets/app.dbd2c2fe.js">
    <link rel="modulepreload" href="/nyanpass-blog/assets/note_web-api-observer.md.7e738ea3.lean.js">
    <link rel="modulepreload" href="/nyanpass-blog/assets/app.dbd2c2fe.js">
    
    
  </head>
  <body>
    <div id="app"><!--[--><div class="no-sidebar theme"><header class="nav-bar" data-v-c0a2c60c><div class="sidebar-button" data-v-c0a2c60c><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/nyanpass-blog/" aria-label="ZRQ30之喵帕斯博客, back to home" data-v-c0a2c60c data-v-7a4ac696><img class="logo" src="/nyanpass-blog/mps.png" alt="Logo" data-v-7a4ac696> ZRQ30之喵帕斯博客</a><div class="flex-grow" data-v-c0a2c60c></div><div class="nav" data-v-c0a2c60c><nav class="nav-links" data-v-c0a2c60c data-v-f73db414><!--[--><div class="item" data-v-f73db414><div class="nav-link" data-v-f73db414 data-v-3f935ff0><a class="item" href="/nyanpass-blog/nyan" data-v-3f935ff0>喵 <!----></a></div></div><div class="item" data-v-f73db414><div class="nav-link" data-v-f73db414 data-v-3f935ff0><a class="item" href="/nyanpass-blog/pa" data-v-3f935ff0>帕 <!----></a></div></div><div class="item" data-v-f73db414><div class="nav-link" data-v-f73db414 data-v-3f935ff0><a class="item" href="/nyanpass-blog/ss" data-v-3f935ff0>斯 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-4b92f82c><nav class="nav-links nav" data-v-4b92f82c data-v-f73db414><!--[--><div class="item" data-v-f73db414><div class="nav-link" data-v-f73db414 data-v-3f935ff0><a class="item" href="/nyanpass-blog/nyan" data-v-3f935ff0>喵 <!----></a></div></div><div class="item" data-v-f73db414><div class="nav-link" data-v-f73db414 data-v-3f935ff0><a class="item" href="/nyanpass-blog/pa" data-v-3f935ff0>帕 <!----></a></div></div><div class="item" data-v-f73db414><div class="nav-link" data-v-f73db414 data-v-3f935ff0><a class="item" href="/nyanpass-blog/ss" data-v-3f935ff0>斯 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-2b25a7d0><div class="container" data-v-2b25a7d0><!--[--><!--]--><div class="content" data-v-2b25a7d0><div data-v-2b25a7d0><h2 id="现代浏览器observerapi"><a class="header-anchor" href="#现代浏览器observerapi" aria-hidden="true">#</a> 现代浏览器ObserverAPI</h2><ul><li><code>Intersection Observer</code>,交叉观察者.</li><li><code>Mutation Observer</code>,变动观察者.</li><li><code>Resize Observer</code>,视图观察者.</li><li><code>Performance Observer</code>,性能观察者.</li></ul><h3 id="intersectionobserver"><a class="header-anchor" href="#intersectionobserver" aria-hidden="true">#</a> IntersectionObserver</h3><p>todo...</p><h3 id="mutationobserver"><a class="header-anchor" href="#mutationobserver" aria-hidden="true">#</a> MutationObserver</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver" target="_blank" rel="noopener noreferrer"><code>MutationObserver</code></a>接口提供了监视对DOM树所做更改的能力.</p><p>观察Dom属性,子节点以及后代节点的变化</p><div class="language-javascript"><pre><code><span class="token comment">// 选择需要观察变动的节点</span>
<span class="token keyword">const</span> targetNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;some-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 观察器的配置（需要观察什么变动）</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span> attributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> childList<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> subtree<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 当观察到变动时执行的回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mutationsList<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use traditional &#39;for loops&#39; for IE 11</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> mutation <span class="token keyword">of</span> mutationsList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;childList&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;A child node has been added or removed.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;attributes&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;The &#39;</span> <span class="token operator">+</span> mutation<span class="token punctuation">.</span>attributeName <span class="token operator">+</span> <span class="token string">&#39; attribute was modified.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个观察器实例并传入回调函数</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 以上述配置开始观察目标节点</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>targetNode<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 之后，可停止观察</span>
observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="resizeobserver"><a class="header-anchor" href="#resizeobserver" aria-hidden="true">#</a> ResizeObserver</h3><p>Resize Observer API提供了一种高性能的机制，通过该机制，代码可以监视元素的大小更改，并且每次大小更改时都会向观察者传递通知.</p><p>观察窗口变化</p><div class="language-javascript"><pre><code>      <span class="token keyword">const</span> myObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResizeObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;大小位置&#39;</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>contentRect<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;监听的DOM&#39;</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      myObserver<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
</code></pre></div><h3 id="performance-observer"><a class="header-anchor" href="#performance-observer" aria-hidden="true">#</a> Performance Observer</h3><p>todo...</p><h3 id="observer案例"><a class="header-anchor" href="#observer案例" aria-hidden="true">#</a> Observer案例</h3><p>MutationObserver + ResizeObserver 实现顶部菜单的自动折叠<a href="https://www.antdv.com/components/menu-cn/#components-menu-demo-top-navigation" target="_blank" rel="noopener noreferrer">Demo</a> <a href="https://github.com/vueComponent/ant-design-vue/blob/0bdaf14d1e6119cf794161ff5be21a681e68ae53/components/vc-menu/DOMWrap.jsx" target="_blank" rel="noopener noreferrer">源码</a></p><p>MutationObserver 找出游戏<a href="https://kolor.moro.es/" target="_blank" rel="noopener noreferrer">KOLOR</a>答案 <a href="https://benhuang.info/2019/02/20/hacking-the-color-picker-game-mutationobserver/" target="_blank" rel="noopener noreferrer">文章</a></p><p>ResizeObserver 实现Vue响应式组件<a href="https://github.com/kelin2025/vue-responsive-components" target="_blank" rel="noopener noreferrer">源码</a></p></div></div><footer class="page-footer" data-v-2b25a7d0 data-v-ad063ca8><div class="edit" data-v-ad063ca8><div class="edit-link" data-v-ad063ca8 data-v-1501f284><!----></div></div><div class="updated" data-v-ad063ca8><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"docs.md\":\"0369a94c\",\"getting-started.md\":\"02a5066a\",\"index.md\":\"1e2b545e\",\"nyan.md\":\"977bf629\",\"pa.md\":\"7123f7c6\",\"readme.md\":\"170e7b53\",\"ss.md\":\"2cf2147f\",\"note_create-a-new-react-app.md\":\"4e7f8f13\",\"note_v-component-keep-alive.md\":\"1ba3e27b\",\"note_web-api-observer.md\":\"7e738ea3\"}")</script>
    <script type="module" async src="/nyanpass-blog/assets/app.dbd2c2fe.js"></script>
  </body>
</html>